<%- include('../shop/layout/user-header.ejs') %>
    <!-- Header Info Begin -->

    <style>
        .clear-bt {
margin-top: 10px;
  padding: 10px 20px; /* adjust padding to change button size */
  font-size: 16px; /* adjust font size to change button text size */
  height: 45px; /* adjust height to change button height */
  
}

    </style>
    <div class="header-info">
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-4">
                    <div class="header-item">
                        <img src="/shop/img/icons/delivery.png" alt="">
                        <p>Free shipping on orders over $30 in USA</p>
                    </div>
                </div>
                <div class="col-md-4 text-left text-lg-center">
                    <div class="header-item">
                        <img src="/shop/img/icons/voucher.png" alt="">
                        <p>20% Student Discount</p>
                    </div>
                </div>
                <div class="col-md-4 text-left text-xl-right">
                    <div class="header-item">
                        <img src="/shop/img/icons/sales.png" alt="">
                        <p>30% off on dresses. Use code: 30OFF</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Header Info End -->
    <!-- Header End -->

    <!-- Page Add Section Begin -->
    <section class="page-add cart-page-add">
        <div class="container">
            <div class="row">
                <div class="col-lg-4">
                    <div class="page-breadcrumb">
                        <h2>Cart<span>.</span></h2>
                        
                    </div>
                </div>
                <div class="col-lg-8">
                    <img src="/shop/img/add.jpg" alt="">
                </div>
            </div>
        </div>
    </section>
    <!-- Page Add Section End -->

    <!-- Cart Page Section Begin -->

    <div class="cart-page">
        <div class="container">
            <div class="cart-table">
                <table>
                    <thead>
                        <tr>
                            <th class="product-h">Product</th>
                            <th>Price</th>
                            <th class="quan">Quantity</th>
                            <th>Total</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <%= console.log(products); %>

                        <% products.forEach(product=> { %>
                            <input id="<%= product.productId._id %>" type="text" hidden
                                value="<%= product.productId._id %>">
                            <tr>
                                <td class="product-col">
                                    <div class="product-images">
                                        <% product.productId.productImage.forEach(image=> { %>
                                            <img src="/uploads/<%= product.productId.productImage %>.jpg" alt=""
                                                width="130" height="150">
                                            <% }) %>
                                    </div>
                                    <%= console.log(product.quantity) %>
                                        <div class="p-title">
                                            <h5>
                                                <%= product.productId.productName %>
                                            </h5>
                                        </div>
                                </td>
                                <td class="price-col"><span id="rate-<%= product.productId._id %>">
                                    <%= product.productId.productPrice %>
                                </span>
   
                                    
                                </td>
                                <td class="quantity-col">

                                    <div class="pro-qty" data-product-id="<%= product.productId._id %>">
                                        <input type="text" value=<%=product.quantity %>>

                                    </div>
                                </td>

<input id="total-<%= product.productId._id %>" type="text" hidden>

                                <input id="total-<%= product.productId.productPrice * product.quantity %>" type="text" hidden
                            >
                         



                                <td class="total"><span id="qty-<%= product.productId._id %>">
                                    <%= product.productId.productPrice * product.quantity %>
                                    </span></td>
                                <a>

                                    <td onclick="productRemove('<%= product.productId._id %>')" class="product-close">x
                                    </td>
                                </a>

                            </tr>
                            <% }) %>
                    </tbody>

                </table>
            </div>
            <div class="cart-btn">
                <div class="row">
                    <div class="col-lg-6">
                        <div class="coupon-input">
                            <input type="text" placeholder="Enter cupone code">
                            <div class="site-btn clear-bt" >Apply Coupon</div>
                        </div>
                    </div>
                  
                    <div class="col-lg-6 offset-lg-6 text-left text-lg-right">
                        <div class="site-btn ">Clear Cart</div>
                        <div class="site-btn ">Continue Shopping</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="shopping-method">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="shipping-info">
                            <h5>Choose a shipping</h5>
                            <div class="chose-shipping">
                                <div class="cs-item">
                                    <input type="radio" name="cs" id="one">
                                    <label for="one" class="active">
                                        Free Standard shhipping
                                        <span>Estimate for New York</span>
                                    </label>
                                </div>
                                <div class="cs-item">
                                    <input type="radio" name="cs" id="two">
                                    <label for="two">
                                        Next Day delievery $10
                                    </label>
                                </div>
                                <div class="cs-item last">
                                    <input type="radio" name="cs" id="three">
                                    <label for="three">
                                        In Store Pickup - Free
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="total-info">
                            <div class="total-table">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Total</th>
                                     
                                            <th>Shipping</th>
                                            <th class="total-cart">Total Cart</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td  > Rs.<span id="total-value1" > 
                                                
                                                <%= total  %> </span></td>



                                            <td class="shipping">Free</td>
                                            
                                            <td class="total-cart-p"> Rs.<span id="total-value2" > 
                                                
                                               <%= total  %> </span></td>
                                              
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="row">
                                <div class="col-lg-12 text-right">
                                    <a href="/GetcheckOut" class="primary-btn chechout-btn">Proceed to checkout</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Cart Page Section End -->

    <!-- Footer Section Begin -->
    <%- include('../shop/layout/user-footer.ejs') %>

        <!-- Footer Section End -->

        <!-- Js Plugins -->
        <script src="shop/js/jquery-3.3.1.min.js"></script>
        <script src="shop/js/bootstrap.min.js"></script>
        <script src="shop/js/jquery.magnific-popup.min.js"></script>
        <script src="shop/js/jquery.slicknav.js"></script>
        <script src="shop/js/owl.carousel.min.js"></script>
        <script src="shop/js/jquery.nice-select.min.js"></script>
        <script src="shop/js/mixitup.min.js"></script>
        <script src="shop/js/main.js"></script>
        </body>

        </html>
        <script>
            function productRemove(productId) {
                console.log(productId);
                swal("Do you want to remove this item from cart?", {
                    buttons: ["No", "yes"],
                }).then((res) => {
                    if (res) {
                        $.ajax({
                            url: '/deleteCartProduct',
                            data: {
                                productId: productId
                            },
                            type: 'post',
                        })
                            .done((res) => {
                                swal("Successful", `${res.message}`, "success").then(() => {
                                    location.reload()
                                })

                            })
                            .fail((error) => {
                                console.log(error);
                            })
                    }
                })

            }
        </script>


        <script>
            var proQty = $('.pro-qty');
            proQty.prepend('<span class="dec qtybtn" >-</span>');
            proQty.append('<span class="inc qtybtn">+</span>');
            proQty.on('click', '.qtybtn', function () {
                console.log('Button clicked!');
                var $button = $(this);
                var $quantityInput = $button.parent().find('input');
                var oldValue = $quantityInput.val();

                var productId = $button.parent().data('product-id');

var qtyspan = document.getElementById(`qty-${productId}`);
var ratespan = document.getElementById(`rate-${productId}`);
var totalspan1 = document.getElementById('total-value1');
var totalspan2 = document.getElementById('total-value2');

console.log(totalspan1);

var price = parseInt(qtyspan.textContent);
var rate = parseInt(ratespan.textContent);
var total = parseInt(totalspan1.textContent);


                if ($button.hasClass('inc')) {
                    var newVal = parseFloat(oldValue) + 1;
                    qtyspan.innerHTML = newVal * rate
                    totalspan1.innerHTML = rate + total
                    totalspan2.innerHTML = rate + total
                    if (newVal > 10) {
                        newVal = 10;
                    }
                    // Disable increment button if quantity reaches maximum limit
                    if (newVal >= 10) {
                        proQty.find('.inc.qtybtn').prop('disabled', true);
                    } else {
                        proQty.find('.inc.qtybtn').prop('disabled', false);
                    }
                } else {
                    if (oldValue > 1) {
                        var newVal = parseFloat(oldValue) - 1;
                        qtyspan.innerHTML = newVal * rate
                          totalspan1.innerHTML =   total - rate
                          totalspan2.innerHTML =   total - rate
                        // Enable increment button when decrementing
                        proQty.find('.inc.qtybtn').prop('disabled', false);
                    } else {
                        newVal = 0;
                    }
                    // Disable decrement button if quantity reaches minimum limit
                    if (newVal <= 1) {
                        proQty.find('.dec.qtybtn').prop('disabled', true);
                    } else {
                        proQty.find('.dec.qtybtn').prop('disabled', false);
                    }
                }

                $quantityInput.val(newVal);

                // Send AJAX request to update product quantity on server-side
                $.ajax({
                    url: '/update-product-quantity',
                    type: 'POST',
                    data: { productId: productId, quantity: newVal },
                    success: function (response) {
                        console.log('Product quantity updated successfully!');
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        console.error('Error updating product quantity:', errorThrown);
                        // Rollback quantity input field value to previous value
                        $quantityInput.val(oldValue);
                    }
                });
                // Disable decrease button if quantity is 1
                if (newVal == 1) {
                    proQty.find('.dec.qtybtn').prop('disabled', true);
                } else {
                    proQty.find('.dec.qtybtn').prop('disabled', false);
                }
            });




        </script>
        <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>